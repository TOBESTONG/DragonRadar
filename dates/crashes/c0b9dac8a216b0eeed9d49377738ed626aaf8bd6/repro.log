Warning: Permanently added '[localhost]:61696' (ED25519) to the list of known hosts.
executing program
syzkaller login: [  139.042747] audit: type=1400 audit(1731008307.929:6): avc:  denied  { execmem } for  pid=236 comm="syz-executor858" scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:system_r:kernel_t:s0 tclass=process permissive=1
[  139.075168] EXT4-fs (loop0): mounted filesystem without journal. Opts: quota,nodelalloc,errors=remount-ro,grpid,
[  139.078167] ext4 filesystem being mounted at /file0 supports timestamps until 2038 (0x7fffffff)
[  139.094331] 
[  139.094773] ======================================================
[  139.096906] WARNING: possible circular locking dependency detected
[  139.098561] 5.10.0 #1 Not tainted
[  139.099487] ------------------------------------------------------
[  139.101662] syz-executor858/236 is trying to acquire lock:
[  139.104323] ffff888018882be8 (&sb->s_type->i_mutex_key#14/4){+.+.}-{3:3}, at: lock_two_nondirectories+0xd1/0x110
[  139.107113] 
[  139.107113] but task is already holding lock:
[  139.108672] ffff888018882210 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}, at: lock_two_nondirectories+0xec/0x110
[  139.111224] 
[  139.111224] which lock already depends on the new lock.
[  139.111224] 
[  139.113366] 
[  139.113366] the existing dependency chain (in reverse order) is:
[  139.115325] 
[  139.115325] -> #3 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}:
[  139.117111]        down_write+0x8d/0x150
[  139.117930]        ext4_xattr_set_entry+0x299e/0x37c0
[  139.118702]        ext4_xattr_block_set+0x834/0x2f50
[  139.119481]        ext4_xattr_set_handle+0xd01/0x12b0
[  139.120263]        ext4_xattr_set+0x13a/0x340
[  139.120959]        __vfs_setxattr+0x10f/0x170
[  139.121653]        __vfs_setxattr_noperm+0x11a/0x4c0
[  139.122446]        __vfs_setxattr_locked+0x1bf/0x250
[  139.123212]        vfs_setxattr+0xe8/0x270
[  139.123853]        setxattr+0x23d/0x330
[  139.124463]        path_setxattr+0x170/0x190
[  139.125120]        __x64_sys_setxattr+0xc0/0x160
[  139.125861]        do_syscall_64+0x33/0x40
[  139.126500]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  139.127369] 
[  139.127369] -> #2 (&ei->xattr_sem){++++}-{3:3}:
[  139.128302]        down_write+0x8d/0x150
[  139.128916]        ext4_xattr_set_handle+0x15e/0x12b0
[  139.129697]        ext4_initxattrs+0xb5/0x120
[  139.130388]        security_inode_init_security+0x1a7/0x350
[  139.131267]        __ext4_new_inode+0x38ec/0x55b0
[  139.131994]        ext4_create+0x2ce/0x4d0
[  139.132647]        lookup_open+0xf52/0x1330
[  139.133309]        path_openat+0x93f/0x26f0
[  139.133956]        do_filp_open+0x17e/0x3c0
[  139.134611]        do_sys_openat2+0x16d/0x420
[  139.135277]        __x64_sys_openat+0x13f/0x1f0
[  139.135973]        do_syscall_64+0x33/0x40
[  139.136599]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  139.137458] 
[  139.137458] -> #1 (jbd2_handle){++++}-{0:0}:
[  139.138347]        start_this_handle+0x103d/0x1440
[  139.139083]        jbd2__journal_start+0x3d3/0x960
[  139.139856]        __ext4_journal_start_sb+0x210/0x490
[  139.140667]        ext4_rename+0x963/0x2640
[  139.141311]        ext4_rename2+0x1af/0x240
[  139.141958]        vfs_rename+0xf1b/0x1960
[  139.142595]        do_renameat2+0x732/0xb80
[  139.143242]        __x64_sys_rename+0x5d/0x80
[  139.143911]        do_syscall_64+0x33/0x40
[  139.144540]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  139.145396] 
[  139.145396] -> #0 (&sb->s_type->i_mutex_key#14/4){+.+.}-{3:3}:
[  139.146523]        __lock_acquire+0x2ac4/0x5ca0
[  139.147218]        lock_acquire+0x293/0x9b0
[  139.147863]        down_write_nested+0x91/0x150
[  139.148558]        lock_two_nondirectories+0xd1/0x110
[  139.149335]        vfs_rename+0x3cf/0x1960
[  139.149973]        do_renameat2+0x732/0xb80
[  139.150623]        __x64_sys_rename+0x5d/0x80
[  139.151300]        do_syscall_64+0x33/0x40
[  139.151935]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  139.152786] 
[  139.152786] other info that might help us debug this:
[  139.152786] 
[  139.153985] Chain exists of:
[  139.153985]   &sb->s_type->i_mutex_key#14/4 --> &ei->xattr_sem --> &ea_inode->i_rwsem#14/1
[  139.153985] 
[  139.155905]  Possible unsafe locking scenario:
[  139.155905] 
[  139.156803]        CPU0                    CPU1
[  139.157500]        ----                    ----
[  139.158194]   lock(&ea_inode->i_rwsem#14/1);
[  139.158850]                                lock(&ei->xattr_sem);
[  139.159772]                                lock(&ea_inode->i_rwsem#14/1);
[  139.160802]   lock(&sb->s_type->i_mutex_key#14/4);
[  139.161540] 
[  139.161540]  *** DEADLOCK ***
[  139.161540] 
[  139.162444] 3 locks held by syz-executor858/236:
[  139.163168]  #0: ffff888010e46438 (sb_writers#3){.+.+}-{0:0}, at: do_renameat2+0x353/0xb80
[  139.164439]  #1: ffff888018881838 (&type->i_mutex_dir_key#3/1){+.+.}-{3:3}, at: lock_rename+0x225/0x280
[  139.165885]  #2: ffff888018882210 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}, at: lock_two_nondirectories+0xec/0x110
[  139.167429] 
[  139.167429] stack backtrace:
[  139.168113] CPU: 1 PID: 236 Comm: syz-executor858 Not tainted 5.10.0 #1
[  139.169120] Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[  139.170627] Call Trace:
[  139.171025]  dump_stack+0x107/0x163
[  139.171577]  check_noncircular+0x25f/0x2e0
[  139.172218]  ? print_circular_bug+0x450/0x450
[  139.172894]  ? print_irqtrace_events+0x270/0x270
[  139.173639]  ? alloc_chain_hlocks+0x4bf/0xc80
[  139.174324]  ? add_lock_to_list.constprop.0+0x68/0x500
[  139.175146]  __lock_acquire+0x2ac4/0x5ca0
[  139.175774]  ? lockdep_hardirqs_on_prepare+0x420/0x420
[  139.176561]  lock_acquire+0x293/0x9b0
[  139.177134]  ? lock_two_nondirectories+0xd1/0x110
[  139.177845]  ? lock_release+0x6f0/0x6f0
[  139.178443]  down_write_nested+0x91/0x150
[  139.179067]  ? lock_two_nondirectories+0xd1/0x110
[  139.179796]  ? _down_write_nest_lock+0x150/0x150
[  139.180515]  lock_two_nondirectories+0xd1/0x110
[  139.181220]  vfs_rename+0x3cf/0x1960
[  139.181772]  ? lookup_positive_unlocked+0xc0/0xc0
[  139.182497]  ? _raw_spin_unlock+0x24/0x40
[  139.183276]  do_renameat2+0x732/0xb80
[  139.183851]  ? __ia32_sys_symlink+0x70/0x70
[  139.184498]  ? dput+0x35/0xc70
[  139.184985]  ? security_inode_permission+0xcb/0x100
[  139.185741]  __x64_sys_rename+0x5d/0x80
[  139.186342]  do_syscall_64+0x33/0x40
[  139.186897]  entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  139.187676] RIP: 0033:0x7f173cdadacd
[  139.188240] Code: b3 66 2e 0f 1f 84 00 00 00 00 00 66 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 c0 ff ff ff f7 d8 64 89 01 48
[  139.191063] RSP: 002b:00007ffe2cbbba18 EFLAGS: 00000246 ORIG_RAX: 0000000000000052
[  139.192224] RAX: ffffffffffffffda RBX: 0030656c69662f2e RCX: 00007f173cdadacd
[  139.193308] RDX: 00007f173cdadacd RSI: 00000000200001c0 RDI: 0000000020000100
[  139.194390] RBP: 00007ffe2cbbbad0 R08: 0000000000000000 R09: 0000000000000000
[  139.195519] R10: 0000000000000000 R11: 0000000000000246 R12: 00007ffe2cbbbb48
[  139.196596] R13: 00007ffe2cbbbb58 R14: 00007f173ce3bd10 R15: 0000000000000001

VM DIAGNOSIS:
03:38:28  Registers:
info registers vcpu 0

CPU#0
RAX=00007fd3d52a74db RBX=0000000000000061 RCX=0000000000000010 RDX=0000000000000000
RSI=0000000000000061 RDI=00007fd3d52a74d0 RBP=000055a39f4e8469 RSP=00007ffe12c6fa68
R8 =00000000003fffff R9 =8004e1b865c74503 R10=1e6519ff21cd1e57 R11=0000000000000020
R12=000055a39f4e8450 R13=0000000000000004 R14=0000000000000000 R15=00007fd3d52a74d0
RIP=00007fd3d4eeaf4d RFL=00000246 [---Z-P-] CPL=3 II=0 A20=1 SMM=0 HLT=0
ES =0000 0000000000000000 00000000 00000000
CS =0033 0000000000000000 ffffffff 00a0fb00 DPL=3 CS64 [-RA]
SS =002b 0000000000000000 ffffffff 00c0f300 DPL=3 DS   [-WA]
DS =0000 0000000000000000 00000000 00000000
FS =0000 00007fd3d46af900 00000000 00000000
GS =0000 0000000000000000 00000000 00000000
LDT=0000 fffffe0000000000 00000000 00000000
TR =0040 fffffe0000003000 00004087 00008b00 DPL=0 TSS64-busy
GDT=     fffffe0000001000 0000007f
IDT=     fffffe0000000000 00000fff
CR0=80050033 CR2=000055a39f4d1000 CR3=000000000cf80000 CR4=00350ef0
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000d01
FCW=037f FSW=0000 [ST=0] FTW=00 MXCSR=00001f80
FPR0=0000000000000000 0000 FPR1=0000000000000000 0000
FPR2=0000000000000000 0000 FPR3=0000000000000000 0000
FPR4=0000000000000000 0000 FPR5=0000000000000000 0000
FPR6=0000000000000000 0000 FPR7=0000000000000000 0000
YMM00=6161616161616161 6161616161616161 6161616161616161 6161616161616161
YMM01=0000000000000000 0000000000000000 00000000ff000000 0000000000000000
YMM02=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM03=0000000000000000 0000000000000000 00ff000000000000 0000000000000000
YMM04=0000000000000000 0000000000000000 2e2e2e2e2e2e2e2e 2e2e2e2e2e2e2e2e
YMM05=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM06=0000000000000000 0000000000000000 0000000000000021 0000006563697665
YMM07=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM08=7574737271706f6e 6d6c6b6a69686766 6564636261393837 3635343332313040
YMM09=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM10=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM11=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM12=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM13=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM14=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM15=0000000000000000 0000000000000000 0000000000000000 0000000000000000
info registers vcpu 1

CPU#1
RAX=000000000000006c RBX=0000000000000000 RCX=0000000000000000 RDX=00000000000003f8
RSI=ffffffff823c0a41 RDI=ffffffff87a492e0 RBP=ffffffff87a492a0 RSP=ffff8880088373b8
R8 =0000000000000001 R9 =0000000000000003 R10=000000000000001f R11=0000000000000001
R12=000000000000006c R13=0000000000000000 R14=ffffffff87a492a0 R15=dffffc0000000000
RIP=ffffffff823c0a6c RFL=00000002 [-------] CPL=0 II=0 A20=1 SMM=0 HLT=0
ES =0000 0000000000000000 00000000 00000000
CS =0010 0000000000000000 ffffffff 00a09b00 DPL=0 CS64 [-RA]
SS =0018 0000000000000000 ffffffff 00c09300 DPL=0 DS   [-WA]
DS =0000 0000000000000000 00000000 00000000
FS =0000 00005555563c3380 00000000 00000000
GS =0000 ffff88806cf00000 00000000 00000000
LDT=0000 fffffe0000000000 00000000 00000000
TR =0040 fffffe000003e000 00004087 00008b00 DPL=0 TSS64-busy
GDT=     fffffe000003c000 0000007f
IDT=     fffffe0000000000 00000fff
CR0=80050033 CR2=0000564eea3d65d8 CR3=000000000fa22000 CR4=00350ee0
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000d01
FCW=037f FSW=0000 [ST=0] FTW=00 MXCSR=00001f80
FPR0=0000000000000000 0000 FPR1=0000000000000000 0000
FPR2=0000000000000000 0000 FPR3=0000000000000000 0000
FPR4=0000000000000000 0000 FPR5=0000000000000000 0000
FPR6=0000000000000000 0000 FPR7=0000000000000000 0000
YMM00=0000000000000000 0000000000000000 2e79616c7265766f 2e64657473757274
YMM01=0000000000000000 0000000000000000 ffffffffffffffff ffffffffffffffff
YMM02=0000000000000000 0000000000000000 0000000000000000 00000000000000ff
YMM03=0000000000000000 0000000000000000 000000000000ff00 0000000000000000
YMM04=0000000000000000 0000000000000000 00007f173ce2ed80 00007f173ce40b60
YMM05=0000000000000000 0000000000000000 0000000000000001 0000000000000001
YMM06=0000000000000000 0000000000000000 ffffffffffffff00 0000000000000000
YMM07=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM08=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM09=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM10=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM11=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM12=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM13=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM14=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM15=0000000000000000 0000000000000000 0000000000000000 0000000000000000
