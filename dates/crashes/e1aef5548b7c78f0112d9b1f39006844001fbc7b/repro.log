Warning: Permanently added '[localhost]:22050' (ED25519) to the list of known hosts.
executing program
syzkaller login: [  210.657545] audit: type=1400 audit(1730944460.352:6): avc:  denied  { execmem } for  pid=237 comm="syz-executor161" scontext=system_u:system_r:kernel_t:s0 tcontext=system_u:system_r:kernel_t:s0 tclass=process permissive=1
[  210.694313] EXT4-fs (loop0): mounted filesystem without journal. Opts: quota,nodelalloc,errors=remount-ro,grpid,
[  210.696125] ext4 filesystem being mounted at /file0 supports timestamps until 2038 (0x7fffffff)
[  210.700866] 
[  210.701142] ======================================================
[  210.702039] WARNING: possible circular locking dependency detected
[  210.702889] 5.10.0 #1 Not tainted
[  210.703365] ------------------------------------------------------
[  210.704303] syz-executor161/237 is trying to acquire lock:
[  210.705475] ffff888018898ce8 (&ei->i_mmap_sem){++++}-{3:3}, at: ext4_setattr+0xc42/0x20c0
[  210.707806] 
[  210.707806] but task is already holding lock:
[  210.709291] ffff888018898e60 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}, at: do_truncate+0x125/0x1f0
[  210.710770] 
[  210.710770] which lock already depends on the new lock.
[  210.710770] 
[  210.711945] 
[  210.711945] the existing dependency chain (in reverse order) is:
[  210.713050] 
[  210.713050] -> #3 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}:
[  210.714062]        down_write+0x8d/0x150
[  210.714633]        ext4_xattr_set_entry+0x299e/0x37c0
[  210.715368]        ext4_xattr_block_set+0x834/0x2f50
[  210.716102]        ext4_xattr_set_handle+0xd01/0x12b0
[  210.716832]        ext4_xattr_set+0x13a/0x340
[  210.717478]        __vfs_setxattr+0x10f/0x170
[  210.718128]        __vfs_setxattr_noperm+0x11a/0x4c0
[  210.718844]        __vfs_setxattr_locked+0x1bf/0x250
[  210.719569]        vfs_setxattr+0xe8/0x270
[  210.720173]        setxattr+0x23d/0x330
[  210.720737]        path_setxattr+0x170/0x190
[  210.721374]        __x64_sys_setxattr+0xc0/0x160
[  210.722063]        do_syscall_64+0x33/0x40
[  210.722659]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  210.723487] 
[  210.723487] -> #2 (&ei->xattr_sem){++++}-{3:3}:
[  210.724377]        down_write+0x8d/0x150
[  210.724969]        ext4_xattr_set_handle+0x15e/0x12b0
[  210.725711]        ext4_initxattrs+0xb5/0x120
[  210.726372]        security_inode_init_security+0x1a7/0x350
[  210.727197]        __ext4_new_inode+0x38ec/0x55b0
[  210.727889]        ext4_create+0x2ce/0x4d0
[  210.728500]        lookup_open+0xf52/0x1330
[  210.729120]        path_openat+0x93f/0x26f0
[  210.729716]        do_filp_open+0x17e/0x3c0
[  210.730340]        do_sys_openat2+0x16d/0x420
[  210.730978]        __x64_sys_openat+0x13f/0x1f0
[  210.731634]        do_syscall_64+0x33/0x40
[  210.732245]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  210.733056] 
[  210.733056] -> #1 (jbd2_handle){++++}-{0:0}:
[  210.733871]        start_this_handle+0x103d/0x1440
[  210.734573]        jbd2__journal_start+0x3d3/0x960
[  210.735255]        __ext4_journal_start_sb+0x210/0x490
[  210.735999]        ext4_truncate+0x50b/0x1390
[  210.736633]        ext4_setattr+0x13c9/0x20c0
[  210.737274]        notify_change+0xb9e/0x1090
[  210.737903]        do_truncate+0x134/0x1f0
[  210.738512]        do_sys_ftruncate+0x596/0x8b0
[  210.739200]        do_syscall_64+0x33/0x40
[  210.739802]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  210.740618] 
[  210.740618] -> #0 (&ei->i_mmap_sem){++++}-{3:3}:
[  210.741534]        __lock_acquire+0x2ac4/0x5ca0
[  210.742208]        lock_acquire+0x293/0x9b0
[  210.742814]        down_write+0x8d/0x150
[  210.743400]        ext4_setattr+0xc42/0x20c0
[  210.744027]        notify_change+0xb9e/0x1090
[  210.744671]        do_truncate+0x134/0x1f0
[  210.745288]        path_openat+0x1d7a/0x26f0
[  210.745902]        do_filp_open+0x17e/0x3c0
[  210.746528]        do_sys_openat2+0x16d/0x420
[  210.747174]        __x64_sys_creat+0xc9/0x120
[  210.747808]        do_syscall_64+0x33/0x40
[  210.748414]        entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  210.749223] 
[  210.749223] other info that might help us debug this:
[  210.749223] 
[  210.750402] Chain exists of:
[  210.750402]   &ei->i_mmap_sem --> &ei->xattr_sem --> &ea_inode->i_rwsem#14/1
[  210.750402] 
[  210.752074]  Possible unsafe locking scenario:
[  210.752074] 
[  210.752916]        CPU0                    CPU1
[  210.753571]        ----                    ----
[  210.754253]   lock(&ea_inode->i_rwsem#14/1);
[  210.754896]                                lock(&ei->xattr_sem);
[  210.755766]                                lock(&ea_inode->i_rwsem#14/1);
[  210.756748]   lock(&ei->i_mmap_sem);
[  210.757277] 
[  210.757277]  *** DEADLOCK ***
[  210.757277] 
[  210.758133] 2 locks held by syz-executor161/237:
[  210.758795]  #0: ffff88800ccae438 (sb_writers#3){.+.+}-{0:0}, at: path_openat+0x1a6f/0x26f0
[  210.760025]  #1: ffff888018898e60 (&ea_inode->i_rwsem#14/1){+.+.}-{3:3}, at: do_truncate+0x125/0x1f0
[  210.761362] 
[  210.761362] stack backtrace:
[  210.762011] CPU: 1 PID: 237 Comm: syz-executor161 Not tainted 5.10.0 #1
[  210.762947] Hardware name: QEMU Ubuntu 24.04 PC (i440FX + PIIX, 1996), BIOS 1.16.3-debian-1.16.3-2 04/01/2014
[  210.764378] Call Trace:
[  210.764748]  dump_stack+0x107/0x163
[  210.765270]  check_noncircular+0x25f/0x2e0
[  210.765877]  ? print_circular_bug+0x450/0x450
[  210.766514]  ? alloc_chain_hlocks+0x4bf/0xc80
[  210.767162]  __lock_acquire+0x2ac4/0x5ca0
[  210.767746]  ? lockdep_hardirqs_on_prepare+0x420/0x420
[  210.768495]  ? avc_has_extended_perms+0xf60/0xf60
[  210.769178]  lock_acquire+0x293/0x9b0
[  210.769722]  ? ext4_setattr+0xc42/0x20c0
[  210.770312]  ? lock_release+0x6f0/0x6f0
[  210.770875]  ? avc_has_perm+0x108/0x1b0
[  210.771454]  ? __dquot_initialize+0x2b2/0xd60
[  210.772089]  down_write+0x8d/0x150
[  210.772601]  ? ext4_setattr+0xc42/0x20c0
[  210.773174]  ? down_write_killable_nested+0x180/0x180
[  210.773910]  ? __inode_security_revalidate+0x108/0x150
[  210.774668]  ? inode_newsize_ok+0x121/0x1e0
[  210.775279]  ? ext4_fc_start_update+0xa2/0x2e0
[  210.775924]  ? selinux_inode_setattr+0x2c4/0x380
[  210.776608]  ext4_setattr+0xc42/0x20c0
[  210.777170]  ? current_time+0x1e6/0x2c0
[  210.777731]  ? igrab+0xb0/0xb0
[  210.778203]  ? ext4_journalled_write_end+0x1210/0x1210
[  210.778957]  notify_change+0xb9e/0x1090
[  210.779526]  do_truncate+0x134/0x1f0
[  210.780062]  ? file_open_root+0x420/0x420
[  210.780648]  ? security_file_open+0x20b/0x500
[  210.781299]  ? may_open+0x1e4/0x400
[  210.781807]  path_openat+0x1d7a/0x26f0
[  210.782379]  ? path_lookupat+0x6c0/0x6c0
[  210.783067]  ? lockdep_hardirqs_on_prepare+0x420/0x420
[  210.783825]  do_filp_open+0x17e/0x3c0
[  210.784378]  ? may_open_dev+0xf0/0xf0
[  210.784929]  ? do_raw_spin_lock+0x121/0x260
[  210.785553]  ? rwlock_bug.part.0+0x90/0x90
[  210.786149]  ? _raw_spin_unlock+0x24/0x40
[  210.786737]  ? __alloc_fd+0x2af/0x620
[  210.787288]  do_sys_openat2+0x16d/0x420
[  210.787847]  ? rcu_read_lock_sched_held+0x3a/0x70
[  210.788544]  ? build_open_flags+0x660/0x660
[  210.789164]  ? trace_event_raw_event_rseq_update+0x200/0x200
[  210.790000]  __x64_sys_creat+0xc9/0x120
[  210.790566]  ? __ia32_sys_openat2+0x280/0x280
[  210.791222]  ? syscall_enter_from_user_mode+0x27/0x80
[  210.791979]  ? lockdep_hardirqs_on+0x79/0x100
[  210.792625]  do_syscall_64+0x33/0x40
[  210.793166]  entry_SYSCALL_64_after_hwframe+0x44/0xa9
[  210.793901] RIP: 0033:0x7f8e47d92acd
[  210.794437] Code: b3 66 2e 0f 1f 84 00 00 00 00 00 66 90 f3 0f 1e fa 48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 c7 c1 c0 ff ff ff f7 d8 64 89 01 48
[  210.797089] RSP: 002b:00007ffc15e3c198 EFLAGS: 00000246 ORIG_RAX: 0000000000000055
[  210.798184] RAX: ffffffffffffffda RBX: 0030656c69662f2e RCX: 00007f8e47d92acd
[  210.799229] RDX: 0000000000000030 RSI: 0000000000000004 RDI: 0000000020000240
[  210.800251] RBP: 00007ffc15e3c250 R08: 0000000000000000 R09: 0000000000000000
[  210.801289] R10: 0000000000000000 R11: 0000000000000246 R12: 00007ffc15e3c2c8
[  210.802314] R13: 00007ffc15e3c2d8 R14: 00007f8e47e20d10 R15: 0000000000000001

VM DIAGNOSIS:
09:54:20  Registers:
info registers vcpu 0

CPU#0
RAX=0000000000000050 RBX=ffff88800bbf0000 RCX=ffffffff8200b154 RDX=00000000000001f7
RSI=ffffffff8200b162 RDI=0000000000000007 RBP=00000000000101f7 RSP=ffff8880081cef68
R8 =0000000000000000 R9 =ffffffff85d66c0f R10=0000000000010000 R11=0000000000000001
R12=00000000000003e7 R13=ffffed100177e001 R14=dffffc0000000000 R15=ffff88800bbf0008
RIP=ffffffff8200b166 RFL=00000093 [--S-A-C] CPL=0 II=0 A20=1 SMM=0 HLT=0
ES =0000 0000000000000000 00000000 00000000
CS =0010 0000000000000000 ffffffff 00a09b00 DPL=0 CS64 [-RA]
SS =0018 0000000000000000 ffffffff 00c09300 DPL=0 DS   [-WA]
DS =0000 0000000000000000 00000000 00000000
FS =0000 00007feb66bc0900 00000000 00000000
GS =0000 ffff88806ce00000 00000000 00000000
LDT=0000 fffffe0000000000 00000000 00000000
TR =0040 fffffe0000003000 00004087 00008b00 DPL=0 TSS64-busy
GDT=     fffffe0000001000 0000007f
IDT=     fffffe0000000000 00000fff
CR0=80050033 CR2=000055dff9260b1d CR3=000000000cfa6000 CR4=00350ef0
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000d01
FCW=037f FSW=0000 [ST=0] FTW=00 MXCSR=00001f80
FPR0=0000000000000000 0000 FPR1=0000000000000000 0000
FPR2=0000000000000000 0000 FPR3=0000000000000000 0000
FPR4=0000000000000000 0000 FPR5=0000000000000000 0000
FPR6=0000000000000000 0000 FPR7=0000000000000000 0000
YMM00=0000000000000000 0000000000000000 7379732f646d6574 7379732f62696c2f
YMM01=0000000000000000 0000000000000000 65747379732f646d 65747379732f6269
YMM02=0000000000000000 0000000000000000 000000ff00000000 0000000000000000
YMM03=0000000000000000 0000000000000000 0000000000000000 00000000ff000000
YMM04=0000000000000000 0000000000000000 2f2f2f2f2f2f2f2f 2f2f2f2f2f2f2f2f
YMM05=0000000000000000 0000000000000000 000055dff91f9130 0000000000000000
YMM06=0000000000000000 0000000000000000 000055dff92055f0 0000000000000040
YMM07=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM08=0000000000000000 0000000000000000 636f5300534b434f 4c74696d694c2e74
YMM09=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM10=0000000000000000 0000000000000000 0000000000000000 0000200000000000
YMM11=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM12=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM13=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM14=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM15=0000000000000000 0000000000000000 0000000000000000 0000000000000000
info registers vcpu 1

CPU#1
RAX=000000000000006b RBX=0000000000000000 RCX=0000000000000000 RDX=00000000000003f8
RSI=ffffffff823c0a41 RDI=ffffffff87a492e0 RBP=ffffffff87a492a0 RSP=ffff888010d87080
R8 =0000000000000001 R9 =0000000000000003 R10=000000000000001f R11=0000000000000001
R12=000000000000006b R13=0000000000000000 R14=ffffffff87a492a0 R15=dffffc0000000000
RIP=ffffffff823c0a6c RFL=00000002 [-------] CPL=0 II=0 A20=1 SMM=0 HLT=0
ES =0000 0000000000000000 00000000 00000000
CS =0010 0000000000000000 ffffffff 00a09b00 DPL=0 CS64 [-RA]
SS =0018 0000000000000000 ffffffff 00c09300 DPL=0 DS   [-WA]
DS =0000 0000000000000000 00000000 00000000
FS =0000 0000555555697380 00000000 00000000
GS =0000 ffff88806cf00000 00000000 00000000
LDT=0000 fffffe0000000000 00000000 00000000
TR =0040 fffffe000003e000 00004087 00008b00 DPL=0 TSS64-busy
GDT=     fffffe000003c000 0000007f
IDT=     fffffe0000000000 00000fff
CR0=80050033 CR2=0000562216eff698 CR3=000000000feee000 CR4=00350ee0
DR0=0000000000000000 DR1=0000000000000000 DR2=0000000000000000 DR3=0000000000000000 
DR6=00000000ffff0ff0 DR7=0000000000000400
EFER=0000000000000d01
FCW=037f FSW=0000 [ST=0] FTW=00 MXCSR=00001f80
FPR0=0000000000000000 0000 FPR1=0000000000000000 0000
FPR2=0000000000000000 0000 FPR3=0000000000000000 0000
FPR4=0000000000000000 0000 FPR5=0000000000000000 0000
FPR6=0000000000000000 0000 FPR7=0000000000000000 0000
YMM00=0000000000000000 0000000000000000 2e79616c7265766f 2e64657473757274
YMM01=0000000000000000 0000000000000000 ffffffffffffffff ffffffffffffffff
YMM02=0000000000000000 0000000000000000 0000000000000000 00000000000000ff
YMM03=0000000000000000 0000000000000000 000000000000ff00 0000000000000000
YMM04=0000000000000000 0000000000000000 00007f8e47e13d80 00007f8e47e25b60
YMM05=0000000000000000 0000000000000000 0000000000000001 0000000000000001
YMM06=0000000000000000 0000000000000000 ffffffffffffff00 0000000000000000
YMM07=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM08=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM09=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM10=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM11=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM12=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM13=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM14=0000000000000000 0000000000000000 0000000000000000 0000000000000000
YMM15=0000000000000000 0000000000000000 0000000000000000 0000000000000000
